# 5.模板渲染

Flask是一种Python web框架，提供了强大的模板功能来帮助开发人员构建动态网站。模板功能允许开发人员将网站中的静态部分与动态部分分离，从而使代码更易于维护和重用。

Flask的模板功能基于Jinja2模板引擎，可以使用标记语言来创建HTML页面。

1. 继承模板：Flask模板允许开发人员创建基本模板，并将其他模板扩展为其子模板。这种模板继承的方法可以减少模板代码的重复，并使代码更易于维护。
2. 变量传递：开发人员可以使用变量将数据传递给模板。在Flask中，变量可以通过render_template()函数传递到模板中，并使用{{ variable_name }}语法在HTML页面中显示。
3. 控制结构：Flask模板允许使用控制结构（如if语句、for循环等）来动态显示网站内容。在HTML页面中使用{% if condition %}和{% for item in list %}等语法可以实现这些控制结构。
4. 静态文件：在Flask中，可以将CSS、JavaScript和图像等静态文件存储在静态文件夹中，并在HTML页面中使用{{ url_for('static', filename='filename.extension') }}语法来引用它们。
5. URL生成：Flask模板还提供了一个方便的方法来生成URL链接。在HTML页面中使用{{ url_for('view_function_name', arg1='value1', arg2='value2') }}语法可以生成指向指定视图函数的URL。
6. ......

这些都是Flask模板功能的一些基本用法，但还有很多其他功能可以探索和使用。Flask模板功能的主要目的是使开发人员可以轻松地创建动态网站，同时减少代码的重复和提高代码的可维护性。

[Jinja2官方文档](http://docs.jinkan.org/docs/jinja2/)

以下是Flask模板功能的一些具体用法：

## 继承模板

模板继承是一种重要的模板功能，可以减少模板代码的重复，并使代码更易于维护。在Flask中，可以使用Jinja2模板引擎来实现模板继承。开发人员可以创建一个基本模板，并在其他模板中使用Jinja2语句来扩展这个基本模板。
例如，创建一个名为`base.html`的基本模板文件，包含HTML页面的通用部分，如导航栏、页脚等。

```html
<!DOCTYPE html>
<html>
  <head>
    <title>{% block title %}{% endblock %}</title>
  </head>
  <body>
    <header>
      <!-- 导航栏等通用部分 -->
    </header>
    
    <main>
      {% block content %}{% endblock %}
    </main>
    
    <footer>
      <!-- 页脚等通用部分 -->
    </footer>
  </body>
</html>
```

然后，可以创建其他模板并扩展基本模板。例如，创建一个名为`index.html`的模板文件，该文件继承`base.html`并覆盖`content`块。

```jinja2
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  <h1>Welcome to my website!</h1>
  <p>This is the home page.</p>
{% endblock %}
```

这样，`index.html`文件将继承`base.html`文件中的通用部分，同时在`content`块中添加特定于该页面的内容。

## 变量传递

Flask模板还可以使用变量将数据传递到模板中，并在HTML页面中显示。在Flask中，变量可以通过`render_template()`函数传递到模板中，并使用`{{ variable_name }}`语法在HTML页面中显示。

例如，在Flask应用程序中定义一个视图函数，该函数将将字符串变量`name`传递给`index.html`模板。

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def index():
    name = "Jayq"
    return render_template("index.html", name=name)
```

然后，在`index.html`模板中，可以使用`{{ name }}`语法来显示该变量。

```jinja2
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  <h1>Welcome to my website, {{ name }}!</h1>
  <p>This is the home page.</p>
{% endblock %}
```

## 控制结构

Flask模板还支持使用控制结构，例如条件语句和循环语句。在Flask中，可以使用Jinja2的控制结构语法来实现这些功能。

### (1) 条件语句

可以使用if语句在模板中根据条件显示不同的内容。例如，在Flask应用程序中定义一个视图函数，该函数将一个整数变量`age`传递到`index.html`模板中，并根据年龄显示不同的消息。

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def index():
    age = 25
    return render_template("index.html", age=age)
```

然后，在`index.html`模板中，可以使用if语句来根据`age`变量显示不同的消息。

```jinja2
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  {% if age < 18 %}
    <h1>You are not old enough to view this website.</h1>
  {% else %}
    <h1>Welcome to my website!</h1>
    <p>This is the home page.</p>
  {% endif %}
{% endblock %}
```

### (2) 循环语句

可以使用for循环语句在模板中重复显示内容。例如，在Flask应用程序中定义一个视图函数，该函数将一个列表`items`传递到`index.html`模板中，并在列表中的每个项目上循环。

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def index():
    items = ["apple", "banana", "cherry"]
    return render_template("index.html", items=items)
```

然后，在`index.html`模板中，可以使用for循环语句在列表中重复显示内容。

```jinja2
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  <h1>My favorite fruits:</h1>
  <ul>
    {% for item in items %}
      <li>{{ item }}</li>
    {% endfor %}
  </ul>
{% endblock %}
```

## 包含模板

在Flask模板中，还可以使用include语句包含其他模板。这可以帮助将模板代码分解为更小的模块，从而使代码更易于维护和重用。

例如，创建一个名为`header.html`的模板文件，该文件包含网站的标题和标志图像。

```html
<header>
  <h1>My Website</h1>
  <img src="logo.png">
</header>
```

然后，在其他模板中，可以使用`{% include "header.html" %}`语句包含此模板。

```jinja2
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  {% include "header.html" %}
  
  <p>This is the home page.</p>
{% endblock %}
```

这样，每个页面都可以包含相同的标头，而无需在每个页面中重复相同的HTML代码。

## 过滤器

在Flask模板中，还可以使用过滤器对变量进行格式化和处理。过滤器是在变量后面添加的方法调用，用于对变量进行转换和处理。

例如，在Flask应用程序中定义一个视图函数，该函数将一个字符串变量`message`传递到`index.html`模板中，并将其转换为大写字母。

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route("/")
def index():
    message = "hello, world!"
    return render_template("index.html", message=message)
```

然后，在`index.html`模板中，可以使用`|`符号和过滤器名称来对变量进行转换和处理。

```html
{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  <h1>{{ message|upper }}</h1>
{% endblock %}
```

在这个例子中，`upper`过滤器将`message`变量转换为大写字母，并在模板中显示结果。

## 总结

Flask的模板功能是一个强大而灵活的工具，可以帮助开发人员轻松地构建动态网页。通过使用模板，可以将业务逻辑和视图分离，并实现代码的重用和维护。在Flask模板中，可以使用变量、控制结构、包含模板、继承模板和过滤器等功能来实现各种需求。掌握这些功能，可以使开发人员更加高效地构建Web应用程序。