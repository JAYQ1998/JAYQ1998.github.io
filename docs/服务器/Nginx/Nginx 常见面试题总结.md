# Nginx å¸¸è§é¢è¯•é¢˜æ€»ç»“

### ä»€ä¹ˆæ˜¯ Nginx ï¼Ÿ 

ä¿„ç½—æ–¯çš„å·¥ç¨‹å¸ˆ Igor Sysoevï¼Œåœ¨ Rambler Media å·¥ä½œæœŸé—´ä½¿ç”¨ C è¯­è¨€å¼€å‘å¹¶å¼€æºäº† Nginxã€‚

Nginx åŒ Apache ä¸€æ ·éƒ½æ˜¯ WEB æœåŠ¡å™¨ï¼Œä¸è¿‡ï¼ŒNginx æ›´åŠ è½»é‡çº§ï¼Œå®ƒçš„å†…å­˜å ç”¨å°‘ï¼Œå¯åŠ¨æå¿«ï¼Œé«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚å¹¶ä¸”ï¼ŒNginx å¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œæ”¯æŒ IMAP/POP3/SMTP æœåŠ¡ã€‚
> Web æœåŠ¡å™¨ï¼šè´Ÿè´£å¤„ç†å’Œå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œä¸€èˆ¬ä¹Ÿç§°ä¸º HTTP æœåŠ¡å™¨ã€‚

å®˜ç½‘ï¼šhttps://nginx.org/

### Nginx çš„ç‰¹ç‚¹æ˜¯æœ‰å“ªäº›ï¼Ÿ 

1. **å†…å­˜å ç”¨éå¸¸å°‘** ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ10000 ä¸ªéæ´»è·ƒçš„ HTTP Keep-Alive è¿æ¥åœ¨ Nginx ä¸­ä»…æ¶ˆè€— 2.5MB çš„å†…å­˜ï¼Œè¿™æ˜¯ Nginx æ”¯æŒé«˜å¹¶å‘è¿æ¥çš„åŸºç¡€ã€‚

2. **é«˜å¹¶å‘** : å•æœºæ”¯æŒ 10 ä¸‡ä»¥ä¸Šçš„å¹¶å‘è¿æ¥

3. **è·¨å¹³å°** :å¯ä»¥è¿è¡Œåœ¨ Linuxï¼ŒWindowsï¼ŒFreeBSDï¼ŒSolarisï¼ŒAIXï¼ŒMac OS ç­‰æ“ä½œç³»ç»Ÿä¸Šã€‚

4. **æ‰©å±•æ€§å¥½** ï¼šç¬¬ä¸‰æ–¹æ’ä»¶éå¸¸å¤šï¼

5. **å®‰è£…ä½¿ç”¨ç®€å•** ï¼šå¯¹äºç®€å•çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½å¤Ÿä¸Šæ‰‹ä½¿ç”¨ã€‚

6. **ç¨³å®šæ€§å¥½** ï¼šbug å°‘ï¼Œä¸ä¼šé‡åˆ°å„ç§å¥‡è‘©çš„é—®é¢˜ã€‚

7. **å…è´¹** ï¼šå¼€æºè½¯ä»¶ï¼Œå…è´¹ä½¿ç”¨ã€‚

8. ......

### Nginx èƒ½ç”¨æ¥åšä»€ä¹ˆï¼Ÿ 

#### é™æ€èµ„æºæœåŠ¡å™¨ 

Nginx æ˜¯ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¯ä»¥å°†æœåŠ¡å™¨ä¸Šçš„é™æ€æ–‡ä»¶ï¼ˆå¦‚ HTMLã€å›¾ç‰‡ï¼‰é€šè¿‡ HTTP åè®®å±•ç°ç»™å®¢æˆ·ç«¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Nginx æ­å»ºé™æ€èµ„æº Web æœåŠ¡å™¨



ä¸è¿‡ï¼Œè®°å¾—ä½¿ç”¨ gzip å‹ç¼©é™æ€èµ„æºæ¥å‡å°‘ç½‘ç»œä¼ è¾“ã€‚



ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬æ¥ä½¿ç”¨ Nginx æ­å»ºä¸€ä¸ªé™æ€ç½‘é¡µæœåŠ¡ã€‚â€ƒ å…ˆå°†é™æ€ç½‘é¡µä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åä¿®æ”¹/nginx/conf ç›®å½•ä¸‹çš„ nginx.conf æ–‡ä»¶(Nginx é…ç½®æ–‡ä»¶)ã€‚ä¿®æ”¹å®Œæˆä¹‹åï¼Œé‡å¯ Nginxï¼Œå†è¯·æ±‚å¯¹åº” ip/åŸŸå + ç«¯å£ + èµ„æº åœ°å€å°±å¯ä»¥è®¿é—®åˆ°ç½‘é¡µã€‚

```nginx
server {
	// ç›‘å¬çš„ç«¯å£å·
	listen       80;
	// server åç§°
	server_name  localhost;

	// åŒ¹é… apiï¼Œå°†æ‰€æœ‰ :80/api çš„è¯·æ±‚æŒ‡åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
	location /api {
		root   /mnt/web/;
		// é»˜è®¤æ‰“å¼€ index.html
		index  index.html index.htm;
	}
}
```

#### åå‘ä»£ç† 

å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨ï¼Œè·å–æ•°æ®åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯¹å¤–æš´éœ²çš„æ˜¯åå‘ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨ IP åœ°å€ã€‚åå‘ä»£ç†â€œä»£ç†â€çš„æ˜¯ç›®æ ‡æœåŠ¡å™¨ï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹å¯¹äºå®¢æˆ·ç«¯è€Œè¨€æ˜¯é€æ˜çš„ã€‚



ä¸¾ä¸ªä¾‹å­ï¼šå…¬å¸å†…ç½‘éƒ¨ç½²äº† 3 å°æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ç›´æ¥ç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘åˆ°å†…ç½‘æœåŠ¡å™¨å¹¶æœ€ç»ˆå†³å®šå“ªä¸€å°æœåŠ¡å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚



![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Freverse-proxy.png&sign=286269bbff8cc1fe87969db28b7a004509c1396407e36ac5150c22f9879d4f74)





åå‘ä»£ç†éšè—äº†çœŸå®çš„æœåŠ¡å™¨ï¼Œä¸ºæœåŠ¡å™¨æ”¶å‘è¯·æ±‚ï¼Œä½¿çœŸå®æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ä¸å¯è§ã€‚ä¸€èˆ¬åœ¨å¤„ç†è·¨åŸŸè¯·æ±‚çš„æ—¶å€™æ¯”è¾ƒå¸¸ç”¨ã€‚ç°åœ¨åŸºæœ¬ä¸Šæ‰€æœ‰çš„å¤§å‹ç½‘ç«™éƒ½è®¾ç½®äº†åå‘ä»£ç†ã€‚



Nginx æ”¯æŒé…ç½®åå‘ä»£ç†ï¼Œé€šè¿‡åå‘ä»£ç†å®ç°ç½‘ç«™çš„è´Ÿè½½å‡è¡¡ã€‚



#### æ­£å‘ä»£ç† 

> æç¤º ï¼šæƒ³è¦ç†è§£æ­£ç¡®ç†è§£å’ŒåŒºåˆ†æ­£å‘ä»£ç†å’Œåå‘ä»£ç†ï¼Œä½ è¦å…³æ³¨çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œæ­£å‘ä»£ç†â€œä»£ç†â€çš„æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†â€œä»£ç†â€çš„æ˜¯ç›®æ ‡æœåŠ¡å™¨ã€‚

> ä¸€ä½å¤§ä½¬è¯´çš„ä¸€å¥è¯æŒºç²¾è¾Ÿçš„ï¼šä»£ç†å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­ä»‹ï¼ŒA å’Œ B æœ¬æ¥å¯ä»¥ç›´è¿ï¼Œä¸­é—´æ’å…¥ä¸€ä¸ª Cï¼ŒC å°±æ˜¯ä¸­ä»‹ã€‚åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä»£ç†å¤šæ•°æ˜¯å¸®åŠ©å†…ç½‘ client è®¿é—®å¤–ç½‘ server ç”¨çš„ï¼ˆæ¯”å¦‚ HTTP ä»£ç†ï¼‰ï¼Œä»å†…åˆ°å¤– . åæ¥å‡ºç°äº†åå‘ä»£ç†ï¼Œ"åå‘"è¿™ä¸ªè¯åœ¨è¿™å„¿çš„æ„æ€å…¶å®æ˜¯æŒ‡æ–¹å‘ç›¸åï¼Œå³ä»£ç†å°†æ¥è‡ªå¤–ç½‘ client çš„è¯·æ±‚ forward åˆ°å†…ç½‘ serverï¼Œä»å¤–åˆ°å†…ã€‚



Nginx ä¸»è¦è¢«ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œä¸è¿‡ï¼Œå…¶åŒæ ·ä¹Ÿæ˜¯æ­£å‘ä»£ç†æœåŠ¡å™¨çš„ä¸€ä¸ªé€‰æ‹©ã€‚

å®¢æˆ·ç«¯é€šè¿‡æ­£å‘ä»£ç†æœåŠ¡å™¨è®¿é—®ç›®æ ‡æœåŠ¡å™¨ã€‚æ­£å‘ä»£ç†â€œä»£ç†â€çš„æ˜¯å®¢æˆ·ç«¯ï¼Œç›®æ ‡æœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯è°ï¼Œä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯å¯¹ç›®æ ‡æœåŠ¡å™¨çš„è¿™æ¬¡è®¿é—®æ˜¯é€æ˜çš„ã€‚



ä¸ºäº†å®ç°æ­£å‘ä»£ç†ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¾ç½®æ­£å‘ä»£ç†æœåŠ¡å™¨çš„ IP åœ°å€ä»¥åŠä»£ç†ç¨‹åºçš„ç«¯å£ã€‚



ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®å¤–ç½‘ï¼Œä½†æ˜¯å¯ä»¥å€ŸåŠ©ç§‘å­¦ä¸Šç½‘å·¥å…· VPN æ¥è®¿é—®ã€‚VPN ä¼šæŠŠè®¿é—®å¤–ç½‘æœåŠ¡å™¨ï¼ˆç›®æ ‡æœåŠ¡å™¨ï¼‰çš„å®¢æˆ·ç«¯è¯·æ±‚ä»£ç†åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥è®¿é—®å¤–ç½‘çš„ä»£ç†æœåŠ¡å™¨ä¸Šå»ã€‚ä»£ç†æœåŠ¡å™¨ä¼šæŠŠå¤–ç½‘æœåŠ¡å™¨è¿”å›çš„å†…å®¹å†è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚



![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fforward-proxy.png&sign=9969dc2bbd628eb70a5b027d4a12a209044785532ca6d6e63b7b0035931aec28)





å¤–ç½‘æœåŠ¡å™¨å¹¶ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯é€šè¿‡ VPN è®¿é—®çš„



ç®€å•æ¥è¯´ï¼š ä½ å¯ä»¥å°†æ­£å‘ä»£ç†çœ‹ä½œæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œå…¶ä¸»è¦ä½œç”¨å°±æ˜¯è½¬è¾¾å®¢æˆ·ç«¯è¯·æ±‚ä»ç›®æ ‡æœåŠ¡å™¨ä¸Šè·å–æŒ‡å®šçš„å†…å®¹ã€‚



ç›¸å…³é˜…è¯»ï¼š



â—[ä½¿ç”¨ Nginx ä½œä¸º HTTPS æ­£å‘ä»£ç†æœåŠ¡å™¨](https://developer.aliyun.com/article/706196)

â—[å›¾è§£åŠä»£ç å®ç°æ­£å‘ä»£ç†ã€åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡](https://bbs.huaweicloud.com/blogs/301714)



#### è´Ÿè½½å‡è¡¡ 

å¦‚æœä¸€å°æœåŠ¡å™¨å¤„ç†ç”¨æˆ·è¯·æ±‚å¤„ç†ä¸è¿‡æ¥çš„è¯ï¼Œä¸€ä¸ªç®€å•çš„åŠæ³•å°±æ˜¯å¢åŠ å¤šå°æœåŠ¡å™¨ï¼ˆæœåŠ¡å™¨é›†ç¾¤ï¼‰éƒ¨ç½²ç›¸åŒçš„æœåŠ¡æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚



Nginx å¯ä»¥å°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚ä»¥ä¸€å®šçš„è§„åˆ™ï¼ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰å‡åŒ€åœ°åˆ†é…åˆ°è¿™ä¸ªæœåŠ¡å™¨é›†ç¾¤ä¸­æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªå°±å«åš è´Ÿè½½å‡è¡¡ã€‚



å¯ä»¥çœ‹å‡ºï¼ŒNginx åœ¨å…¶ä¸­å……å½“çš„å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„ä½œç”¨ï¼Œè´Ÿè½½å‡è¡¡æ­£æ˜¯ Nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨ã€‚



é™¤æ­¤ä¹‹å¤–ï¼ŒNginx è¿˜å¸¦æœ‰å¥åº·æ£€æŸ¥ï¼ˆæœåŠ¡å™¨å¿ƒè·³æ£€æŸ¥ï¼‰åŠŸèƒ½ï¼Œä¼šå®šæœŸè½®è¯¢å‘é›†ç¾¤é‡Œçš„æ‰€æœ‰æœåŠ¡å™¨å‘é€å¥åº·æ£€æŸ¥è¯·æ±‚ï¼Œæ¥æ£€æŸ¥é›†ç¾¤ä¸­æ˜¯å¦æœ‰æœåŠ¡å™¨å¤„äºå¼‚å¸¸çŠ¶æ€ã€‚



![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fnginx-load-balance.png&sign=bfe3a3f2c0613966e67fb3f8be2b919214b128567a875bfe4361113f7c6c44d5)

ç›¸å…³é˜…è¯»ï¼š[ä¸€ç¯‡æ–‡ç« æå®š Nginx åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡](https://codingnote.cc/zh-tw/p/220338/)



#### åŠ¨é™åˆ†ç¦» 

åŠ¨é™åˆ†ç¦»å°±æ˜¯æŠŠåŠ¨æ€è¯·æ±‚å’Œé™æ€è¯·æ±‚åˆ†å¼€ï¼Œä¸æ˜¯è®²åŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç‰©ç†åˆ†ç¦»ï¼Œå¯ä»¥ç†è§£ä¸º Nginx å¤„ç†é™æ€é¡µé¢ï¼ŒTomcat æˆ–è€…å…¶ä»– Web æœåŠ¡å™¨å¤„ç†åŠ¨æ€é¡µé¢ã€‚



åŠ¨é™åˆ†ç¦»å¯ä»¥å‡è½» Tomcat æˆ–è€…å…¶ä»– Web æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæé«˜ç½‘ç«™å“åº”é€Ÿåº¦ã€‚



### Nginx æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ 



ç›¸å…³å‚è€ƒï¼š

â—[äº”åˆ†é’Ÿçœ‹æ‡‚ Nginx è´Ÿè½½å‡è¡¡](https://www.zoo.team/article/nginx)
â—[Nginx å®˜æ–¹æ–‡æ¡£](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/)

Nginx çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸æ­¢ä¸‹é¢ä»‹ç»çš„è¿™å››ç§ï¼Œæˆ‘è¿™é‡Œåªæ˜¯åˆ—ä¸¾å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚



#### è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ 

è½®è¯¢ä¸ºè´Ÿè½½å‡è¡¡ä¸­è¾ƒä¸ºåŸºç¡€ä¹Ÿè¾ƒä¸ºç®€å•çš„ç®—æ³•ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ down æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚

```nginx
upstream backserver {
  server 172.27.26.174:8099;
  server 172.27.26.175:8099;
  server 172.27.26.176:8099;
}
```

ç‰¹ç‚¹ï¼šç”±äºè¯¥ç®—æ³•ä¸­æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨å¤„ç†ï¼Œå› æ­¤é€‚ç”¨äºæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘çš„é›†ç¾¤æƒ…å†µï¼Œå…¶ä¸­æ¯ä¸ªæœåŠ¡å™¨æ‰¿è½½ç›¸åŒçš„è´Ÿè½½ã€‚ä½†å¯¹äºæœåŠ¡å™¨æ€§èƒ½ä¸åŒçš„é›†ç¾¤è€Œè¨€ï¼Œè¯¥ç®—æ³•å®¹æ˜“å¼•å‘èµ„æºåˆ†é…ä¸åˆç†ç­‰é—®é¢˜ã€‚



#### åŠ æƒéšæœº 

weightï¼Œä»£è¡¨æƒé‡ï¼Œæƒé‡è¶Šé«˜çš„åç«¯æœåŠ¡å™¨è¢«è®¿é—®çš„æ¦‚ç‡è¶Šå¤§ã€‚

```nginx
upstream backserver {
  server 172.27.26.174:8099 weight=6;
  server 172.27.26.175:8099 weight=2;
  server 172.27.26.176:8099 weight=3;
}
```

ç‰¹ç‚¹ï¼šåŠ æƒè½®è¯¢å¯ä»¥åº”ç”¨äºæœåŠ¡å™¨æ€§èƒ½ä¸ç­‰çš„é›†ç¾¤ä¸­ï¼Œä½¿èµ„æºåˆ†é…æ›´åŠ åˆç†åŒ–ã€‚



#### IP å“ˆå¸Œ 

æ ¹æ®å‘å‡ºè¯·æ±‚çš„å’ŒæŠ¤çŸ­ ip çš„ hash å€¼æ¥åˆ†é…æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿è¯åŒ IP å‘å‡ºçš„è¯·æ±‚æ˜ å°„åˆ°åŒä¸€æœåŠ¡å™¨ï¼Œæˆ–è€…å…·æœ‰ç›¸åŒ hash å€¼çš„ä¸åŒ IP æ˜ å°„åˆ°åŒä¸€æœåŠ¡å™¨ã€‚



ç‰¹ç‚¹ï¼šè¯¥ç®—æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†é›†ç¾¤éƒ¨ç½²ç¯å¢ƒä¸‹ Session ä¸å…±äº«çš„é—®é¢˜ã€‚

```nginx
upstream backserver {
  ip_hash;
  server 172.27.26.174:8099;
  server 172.27.26.175:8099;
  server 172.27.26.176:8099;
}
```



#### æœ€å°è¿æ¥æ•° 

å½“æœ‰æ–°çš„è¯·æ±‚å‡ºç°æ—¶ï¼Œéå†æœåŠ¡å™¨èŠ‚ç‚¹åˆ—è¡¨å¹¶é€‰å–å…¶ä¸­è¿æ¥æ•°æœ€å°çš„ä¸€å°æœåŠ¡å™¨æ¥å“åº”å½“å‰è¯·æ±‚ã€‚è¿æ¥æ•°å¯ä»¥ç†è§£ä¸ºå½“å‰å¤„ç†çš„è¯·æ±‚æ•°ã€‚

```nginx
upstream backserver {
  least_conn;
  server 172.27.26.174:8099;
  server 172.27.26.175:8099;
  server 172.27.26.176:8099;
}
```



### Nginx å¸¸ç”¨å‘½ä»¤æœ‰å“ªäº›ï¼Ÿ 

- å¯åŠ¨ nginx ã€‚

- åœæ­¢ nginx -s stop æˆ– nginx -s quit ã€‚
- é‡è½½é…ç½® ./sbin/nginx -s reload(å¹³æ»‘é‡å¯) æˆ– service nginx reload ã€‚

- é‡è½½æŒ‡å®šé…ç½®æ–‡ä»¶ .nginx -c /usr/local/nginx/conf/nginx.conf ã€‚

- æŸ¥çœ‹ nginx ç‰ˆæœ¬ nginx -v ã€‚

- æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡® nginx -t ã€‚

- æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ nginx -h ã€‚



### Nginx æ€§èƒ½ä¼˜åŒ–çš„å¸¸è§æ–¹å¼ï¼Ÿ 

- è®¾ç½® Nginx è¿è¡Œå·¥ä½œè¿›ç¨‹ä¸ªæ•° ï¼šä¸€èˆ¬è®¾ç½® CPU çš„æ ¸å¿ƒæ•°æˆ–è€…æ ¸å¿ƒæ•° x2ï¼›

- å¼€å¯ Gzip å‹ç¼© ï¼šè¿™æ ·å¯ä»¥ä½¿ç½‘ç«™çš„å›¾ç‰‡ã€CSSã€JS ç­‰æ–‡ä»¶åœ¨ä¼ è¾“æ—¶è¿›è¡Œå‹ç¼©ï¼Œæé«˜è®¿é—®é€Ÿåº¦, ä¼˜åŒ– Nginx æ€§èƒ½ã€‚è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ[Nginx æ€§èƒ½ä¼˜åŒ–åŠŸèƒ½- Gzip å‹ç¼©(å¤§å¹…åº¦æé«˜é¡µé¢åŠ è½½é€Ÿåº¦)](https://www.cnblogs.com/kevingrace/p/10018914.html)è¿™ç¯‡æ–‡ç« ï¼›

- è®¾ç½®å•ä¸ª worker è¿›ç¨‹å…è®¸å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•° ï¼šä¸€èˆ¬è®¾ç½®ä¸º 65535 å°±è¶³å¤Ÿäº†ï¼›

- è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½® ï¼šé¿å…åœ¨å»ºç«‹æ— ç”¨è¿æ¥ä¸Šæ¶ˆè€—å¤ªå¤šèµ„æºï¼›

- è®¾ç½®ç¼“å­˜ ï¼šåƒå›¾ç‰‡ã€CSSã€JS ç­‰è¿™ç±»ä¸€èˆ¬ä¸ä¼šç»å¸¸ä¿®æ”¹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è®¾ç½®å›¾ç‰‡åœ¨æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ï¼Œæé«˜è®¿é—®é€Ÿåº¦ï¼Œä¼˜åŒ– Nginx æ€§èƒ½ã€‚

- ......



### LVSã€Nginxã€HAproxy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 

> LVSã€Nginxã€HAProxy æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸‰ç§è½¯ä»¶è´Ÿè½½å‡è¡¡è½¯ä»¶ã€‚

- LVS æ˜¯ Linux Virtual Server çš„ç®€ç§°ï¼Œä¹Ÿå°±æ˜¯ Linux è™šæ‹ŸæœåŠ¡å™¨ã€‚LVS æ˜¯å››å±‚è´Ÿè½½å‡è¡¡ï¼Œå»ºç«‹åœ¨ OSI æ¨¡å‹çš„ç¬¬å››å±‚ï¼ˆä¼ è¾“å±‚ï¼‰ä¹‹ä¸Šï¼Œæ€§èƒ½éå¸¸å¼ºå¤§ã€‚

- HAProxy å¯ä»¥å·¥ä½œåœ¨å››å±‚å’Œä¸ƒå±‚ï¼ˆä¼ è¾“å±‚å’Œåº”ç”¨å±‚ï¼‰ï¼Œæ˜¯ä¸“é—¨ç”¨æ¥åšä»£ç†æœåŠ¡å™¨çš„ã€‚

- Nginx è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯å¯¹ä¸ƒå±‚ç½‘ç»œé€šä¿¡æ¨¡å‹ä¸­çš„ç¬¬ä¸ƒå±‚åº”ç”¨å±‚ä¸Šçš„ HTTPã€HTTPS è¿›è¡Œæ”¯æŒã€‚Nginx æ˜¯ä»¥åå‘ä»£ç†çš„æ–¹å¼è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ã€‚



### Nginx å¦‚ä½•å®ç°åç«¯æœåŠ¡å¥åº·æ£€æŸ¥ï¼Ÿ 

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— upstream_check_module æ¥æ£€æµ‹åç«¯æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™æ‰€æœ‰çš„è¯·æ±‚ä¸è½¬å‘åˆ°è¿™å°æœåŠ¡å™¨ã€‚



upstream_check_module æ˜¯ä¸€æ¬¾é˜¿é‡Œçš„ä¸€ä½å¤§ä½¬å¼€æºçš„ï¼Œä½¿ç”¨ Perl å’Œ C ç¼–å†™è€Œæˆï¼ŒGithub åœ°å€ ï¼šhttps://github.com/yaoweibin/nginx_upstream_check_module ã€‚



å…³äº upstream_check_module å®ç°åç«¯æœåŠ¡å¥åº·æ£€æŸ¥çš„å…·ä½“åšæ³•å¯ä»¥å‚è€ƒ[Nginx è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥åŠŸèƒ½](https://cloud.tencent.com/developer/article/1700001)è¿™ç¯‡æ–‡ç« ã€‚



![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fupstream_check_module.png&sign=6dc14850d2a17612b1d06a0889f5ef0ac2ace6f0203e3d0de30b7f4fcf1a2397)





### å¦‚ä½•ä¿è¯ Nginx æœåŠ¡çš„é«˜å¯ç”¨ï¼Ÿ 

Nginx å¯ä»¥ç»“åˆ Keepalived æ¥å®ç°é«˜å¯ç”¨ã€‚

ä»€ä¹ˆæ˜¯ Keepalived ï¼Ÿ æ ¹æ®å®˜ç½‘ä»‹ç»ï¼š

> Keepalived æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„å¼€æºè·¯ç”±è½¯ä»¶ï¼Œæ˜¯ Linux ä¸‹ä¸€ä¸ªè½»é‡çº§åˆ«çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆã€‚Keepalived çš„è´Ÿè½½å‡è¡¡ä¾èµ–äºä¼—æ‰€å‘¨çŸ¥ä¸”å¹¿æ³›ä½¿ç”¨çš„ Linux è™šæ‹ŸæœåŠ¡å™¨ (IPVS å³ IP Virtual Serverï¼Œå†…ç½®åœ¨ Linux å†…æ ¸ä¸­çš„ä¼ è¾“å±‚è´Ÿè½½å‡è¡¡å™¨) å†…æ ¸æ¨¡å—ï¼Œæä¾›ç¬¬ 4 å±‚è´Ÿè½½å¹³è¡¡ã€‚Keepalived å®ç°äº†ä¸€ç»„æ£€æŸ¥å™¨ç”¨äºæ ¹æ®æœåŠ¡å™¨èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µåŠ¨æ€ç»´æŠ¤å’Œç®¡ç†æœåŠ¡å™¨é›†ç¾¤ã€‚
>
> Keepalived çš„é«˜å¯ç”¨æ€§æ˜¯é€šè¿‡è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼ˆVRRP å³ Virtual Router Redundancy Protocolï¼Œå®ç°è·¯ç”±å™¨é«˜å¯ç”¨çš„åè®®ï¼‰å®ç°çš„ï¼Œå¯ä»¥ç”¨æ¥è§£å†³å•ç‚¹æ•…éšœã€‚
>
> Github åœ°å€ï¼šhttps://github.com/acassen/keepalived



Keepalived ä¸ä»…ä»…å¯ä»¥å’Œ Nginx æ­é…ä½¿ç”¨ï¼Œè¿˜å¯ä»¥å’Œ [LVS](https://wsgzao.github.io/post/lvs-keepalived/)ã€[MySQL](https://programmer.group/high-availability-scheme-implementation-of-mysql-master-replication-keepalived.html)ã€[HAProxy](https://docs.oracle.com/cd/E37670_01/E41138/html/section_sm3_svy_4r.html) ç­‰è½¯ä»¶é…åˆä½¿ç”¨ã€‚



å†æ¥ç®€å•ä»‹ç»ä¸€ä¸‹ Keepalived+Nginx å®ç°é«˜å¯ç”¨çš„å¸¸è§æ–¹æ³•ï¼š



1. å‡†å¤‡ 2 å° Nginx æœåŠ¡å™¨ï¼Œä¸€å°ä¸ºä¸»æœåŠ¡ï¼Œä¸€å°ä¸ºå¤‡ç”¨æœåŠ¡ï¼›

2. åœ¨ä¸¤å° Nginx æœåŠ¡å™¨ä¸Šå®‰è£…å¹¶é…ç½® Keepalivedï¼›

3. ä¸ºä¸¤å° Nginx æœåŠ¡å™¨ç»‘å®šåŒä¸€ä¸ªè™šæ‹Ÿ IPï¼›

4. ç¼–å†™ Nginx æ£€æµ‹è„šæœ¬ç”¨äºé€šè¿‡ Keepalived æ£€æµ‹ Nginx ä¸»æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼›



å¦‚æœ Nginx ä¸»æœåŠ¡å™¨å®•æœºçš„è¯ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå¤‡ç”¨ Nginx ä¸»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªåˆ‡æ¢å¯¹å¤–æ˜¯é€æ˜çš„ï¼Œå› ä¸ºä½¿ç”¨çš„è™šæ‹Ÿ IPï¼Œè™šæ‹Ÿ IP ä¸ä¼šæ”¹å˜ã€‚



ç›¸å…³é˜…è¯»ï¼š

â—[Nginx ç³»åˆ—æ•™ç¨‹ï¼ˆäº”ï¼‰| åˆ©ç”¨ Nginx+Keepalived å®ç°é«˜å¯ç”¨æŠ€æœ¯ |](https://juejin.cn/post/6970093569096810526)

â—[æ­å»º Keepalived Nginx é«˜å¯ç”¨ Web é›†ç¾¤ - åä¸ºäº‘](https://support.huaweicloud.com/bestpractice-vpc/bestpractice_0010.html)

ğŸ“„å‹æƒ…æç¤º ï¼šä¸‹é¢çš„å†…å®¹å±äº Nginx çš„è¿›é˜¶æŒ‡ç‚¹ï¼Œä¸»è¦æ˜¯ä¸€äº› Nginx åº•å±‚åŸç†ç›¸å…³çš„çŸ¥è¯†ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µé€‰æ‹©æ˜¯å¦æŒæ¡è¿™éƒ¨åˆ†å†…å®¹ï¼Œå¦‚æœä½ çš„ç®€å†æ²¡æœ‰å†™ç†Ÿç»ƒæŒæ¡ Nginx ä½¿ç”¨åŠåŸç†çš„è¯ï¼Œé¢è¯•å®˜ä¸€èˆ¬ä¸ä¼šé—®è¿™ä¹ˆæ·±å…¥ã€‚



### Nginx æ€»ä½“æ¶æ„äº†è§£å—ï¼Ÿ 

å…³äº Nginx æ€»ç»“æ¶æ„çš„è¯¦ç»†è§£ç­”ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š[æœ€è¿‘å’Œ Nginx æ ä¸Šäº†ï¼](https://mp.weixin.qq.com/s/CxapDUkSdqBbuJU4JrQ8Aw)

å¯¹äºä¼ ç»Ÿçš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨è€Œè¨€ï¼Œåœ¨å¤„ç†å¹¶å‘è¯·æ±‚çš„æ—¶å€™ä¼šä½¿ç”¨å•è¿›ç¨‹æˆ–çº¿ç¨‹çš„æ¨¡å¼å¤„ç†ï¼ŒåŒæ—¶ä¼šæ­¢ç½‘ç»œæˆ–è¾“å…¥/è¾“å‡ºæ“ä½œã€‚



è¿™ç§æ–¹å¼ä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜å’Œ CPU èµ„æºã€‚å› ä¸ºæ¯äº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æˆ–çº¿ç¨‹éœ€è¦å‡†å¤‡ä¸€å¥—æ–°çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒ…æ‹¬åˆ†é…å †å’Œå †æ ˆå†…å­˜ï¼Œä»¥åŠåˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚



å¯ä»¥æƒ³è±¡åœ¨å¤„ç†å¤šè¯·æ±‚æ—¶ä¼šç”Ÿæˆå¯¹åº”æ•°ç›®çš„çº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œå¯¼è‡´ç”±äºçº¿ç¨‹åœ¨ä¸æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸Šè€—è´¹å¤§é‡èµ„æºã€‚



ç”±äºä¸Šé¢çš„åŸå› ï¼ŒNginx åœ¨è®¾è®¡ä¹‹åˆå°±ä½¿ç”¨äº†æ¨¡å—åŒ–ã€äº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥å¤„ç†ï¼Œéé˜»å¡çš„æ¶æ„ã€‚



ä¸€å¼ å›¾æ¥äº†è§£ Nginx çš„æ€»ç»“æ¶æ„:



![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fnginx-architecture.png&sign=9389ed376428d8dbd445f0b6e330b0977bc9158f5b4cf06a33f6c3214c90c164)





### Nginx è¿›ç¨‹æ¨¡å‹äº†è§£ä¹ˆï¼Ÿ 

å…³äºè¿›ç¨‹æ¨¡å‹çš„è¯¦ç»†è§£ç­”ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š[Nginx å·¥ä½œæ¨¡å¼å’Œè¿›ç¨‹æ¨¡å‹](https://learnku.com/articles/38414)

Nginx å¯åŠ¨åï¼Œä¼šäº§ç”Ÿä¸€ä¸ª master ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ‰§è¡Œä¸€ç³»åˆ—çš„å·¥ä½œåä¼šäº§ç”Ÿä¸€ä¸ªæˆ–è€…å¤šä¸ªå·¥ä½œè¿›ç¨‹ worker è¿›ç¨‹ã€‚master è¿›ç¨‹ç”¨æ¥ç®¡ç† worker è¿›ç¨‹ï¼Œ worker è¿›ç¨‹è´Ÿè´£å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ Nginx é‡‡ç”¨çš„æ˜¯ç»å…¸çš„ master-worker æ¨¡å‹çš„å¤šè¿›ç¨‹æ¨¡å‹ ã€‚



### Nginx å¦‚ä½•å¤„ç† HTTP è¯·æ±‚ï¼Ÿ 



â—[Nginx æ˜¯å¦‚ä½•å¤„ç† HTTP å¤´éƒ¨çš„ï¼Ÿ](https://segmentfault.com/a/1190000022348375)

â—[Nginx å¤„ç† HTTP è¯·æ±‚çš„ 11 ä¸ªé˜¶æ®µ](https://segmentfault.com/a/1190000022709975)



### ç³»ç»Ÿå­¦ä¹  

Guide æ•´ç†äº†ä¸‹é¢ä¸€äº›æ–‡ç« å’Œä¹¦ç±å¸®åŠ©ä½ ç³»ç»Ÿå­¦ä¹  Nginxã€‚

#### æ–‡ç« æ¨è 

â—[è¿å‰ç«¯éƒ½çœ‹å¾—æ‡‚çš„ã€ŠNginx å…¥é—¨æŒ‡å—ã€‹](https://juejin.cn/post/6844904129987526663)

â—[Nginx å…¥é—¨æ•™ç¨‹ï¼Œæ•²ç®€å•ï¼Œ10 åˆ†é’Ÿæå®š](https://juejin.cn/post/7046190661015437325)

â—[Nginx æœ€å…¨æ“ä½œæ€»ç»“ - è…¾è®¯æŠ€æœ¯å·¥ç¨‹](https://mp.weixin.qq.com/s?src=11&timestamp=1644900743&ver=3621&signature=kF*VLvQFEeSVlGkPxn542LNLa7S1gQpIZrgywwvQR5EH*p3jwU*HW0GeyQYOeQ3HrPJag8mIjHQg3C0PW72Y-JyGFgsUh-yUiIbrxwnzsHE02e4Plp8vyYINJfb-3WYW&new=1)

â—[Nginx ç³»åˆ—ï¼šNginx åŸç†](http://ningg.top/nginx-series-principle/)

â—[Nginx æµé‡å¤åˆ¶](https://www.cnblogs.com/cjsblog/p/12163207.html)



#### ä¹¦ç±æ¨è 

[ã€Šæ·±å…¥ç†è§£ Nginxï¼ˆç¬¬ 2 ç‰ˆï¼‰ã€‹](https://book.douban.com/subject/26745255/) è¿™æœ¬ä¹¦æ˜¯åˆå­¦è€…å­¦ä¹  Nginx çš„é¦–é€‰ï¼Œè®²çš„éå¸¸ç»†è‡´ï¼

![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fdushubiji%2F%2Fimage-20220218235549779.png&sign=1290a042a292f2560f2539e19c51b6d00da3867076b34e362ec340d59ad31a58)



ä½ å¯ä»¥é…åˆ [nginx-tutorial](https://github.com/dunwu/nginx-tutorial) è¿™ä¸ªå¼€æº Nginx æç®€æ•™ç¨‹é£Ÿç”¨ã€‚

![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fnginx-tutorial.png&sign=2642be84e09558130356d235022fa85215062301a7c79e759fc80a701ea39ee3)



æœ€åå†æ¨èä¸€ä¸ªå¯ä»¥åœ¨çº¿ç»ƒä¹ ä½¿ç”¨ Nginx çš„ç½‘ç«™ï¼šhttps://nginx-playground.wizardzines.com/ ã€‚

![img](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fgitee.com%2FSnailClimb%2Fblog-images%2Fraw%2Fmaster%2Fnginx%2F%2Fimage-20220216130032820.png&sign=12c3fe3969cc4d5d227c88f1cf540a8069a68b0b04e77babe1f09a32ab566e8a)





 å‚è€ƒ 

â—[æ­£å‘ä»£ç†ä¸åå‘ä»£ç†ã€æ€»ç»“ã€‘](https://www.cnblogs.com/Anker/p/6056540.html)

â—[Nginx è¯¦è§£ï¼šNginx æ˜¯ä»€ä¹ˆ? èƒ½å¹²å˜›?](https://kb.cnblogs.com/page/661047/)